<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="src" href="../api/modules.html" /><link rel="prev" title="Driver Guide" href="../guides/driverguide.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Worked Examples - chronostar-tng 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">chronostar-tng 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">chronostar-tng 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to Chronostar</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../gettingstarted.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../userdocs/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userdocs/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userdocs/cli.html">Command-Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userdocs/scripts.html">Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userdocs/settings.html">Configuration Settings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../generaloverview.html">General Overview</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/componentguide.html">Component Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/mixtureguide.html">Mixture Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/introducerguide.html">Introducer Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/icpoolguide.html">Initial Conditions Pool Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/driverguide.html">Driver Guide</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Worked Examples</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/modules.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/chronostar.html">chronostar package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.component.html">chronostar.component package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.icpool.html">chronostar.icpool package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.mixture.html">chronostar.mixture package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.utils.html">chronostar.utils package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="worked-examples">
<h1>Worked Examples<a class="headerlink" href="#worked-examples" title="Permalink to this heading">#</a></h1>
<p>Here we outline a couple of worked examples which demonstrate how to use
Chronstar.</p>
<section id="synthetic-example">
<h2>Synthetic Example<a class="headerlink" href="#synthetic-example" title="Permalink to this heading">#</a></h2>
<p>For testing purposes, Chronostar has a built in synthetic data generator,
<code class="xref py py-class docutils literal notranslate"><span class="pre">SynthData</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t look too closely at the source since it’s still a bit of a mess…</p>
</div>
<section id="generating-synthetic-data">
<h3>Generating Synthetic Data<a class="headerlink" href="#generating-synthetic-data" title="Permalink to this heading">#</a></h3>
<p>The process of synth data generation is as follows:</p>
<ul class="simple">
<li><p>Define the initial mean and covariance of one or more independent 6D Gaussian stellar distributions in cartesian space (right-handed system, centered on the local standard of rest, such that <code class="docutils literal notranslate"><span class="pre">X</span></code> points towards the Galactic Center)</p></li>
<li><p>Randomly sample points from the distributions, this are the stars’ birth places</p></li>
<li><p>Project each star forward through time by the age of its component to get the cartesian data of their current positions</p></li>
<li><p>Convert cartesian data into observables by “measuring”</p></li>
<li><p>Assign measurement uncertainties to the observables based on log-normal distributions fitted to Gaia data</p></li>
<li><p>Offset each measurment by some amount, where the amount is drawn from a normal distribution, with <span class="math notranslate nohighlight">\(\mu=0\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> equal to the assigned measurement uncertainty.</p></li>
</ul>
<p>This process will provide us with a relatively realistic astrometry dataset, formatted like
a fits file downloaded from Gaia. In code, this looks like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">chronostar</span> <span class="kn">import</span> <span class="n">synthdata</span>
<span class="kn">from</span> <span class="nn">chronostar</span> <span class="kn">import</span> <span class="n">datatools</span>

<span class="c1"># Define a &quot;background&quot; component</span>
<span class="n">DIM</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">bg_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DIM</span><span class="p">)</span>
<span class="n">bg_stdev_pos</span> <span class="o">=</span> <span class="mf">500.</span>
<span class="n">bg_stdev_vel</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">bg_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DIM</span><span class="p">)</span>
<span class="n">bg_cov</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">bg_stdev_pos</span><span class="o">**</span><span class="mi">2</span>
<span class="n">bg_cov</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="n">bg_stdev_vel</span><span class="o">**</span><span class="mi">2</span>

<span class="n">bg_age</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">bg_nstars</span> <span class="o">=</span> <span class="mi">1_000</span>

<span class="c1"># Define an &quot;association&quot; component</span>
<span class="n">assoc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">DIM</span><span class="p">)</span>
<span class="n">assoc_stdev_pos</span> <span class="o">=</span> <span class="mf">50.</span>
<span class="n">assoc_stdev_vel</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">assoc_age</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">assoc_nstars</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">assoc_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DIM</span><span class="p">)</span>
<span class="n">assoc_cov</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">assoc_stdev_pos</span><span class="o">**</span><span class="mi">2</span>
<span class="n">assoc_cov</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="n">assoc_stdev_vel</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Generate each component stars&#39; current positions in cartesian space</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="c1"># Generate a component with current day mean `bg_mean`, and with a birth covariance</span>
<span class="c1"># of `bg_cov`</span>
<span class="n">bg_stars</span> <span class="o">=</span> <span class="n">synthdata</span><span class="o">.</span><span class="n">generate_association</span><span class="p">(</span>
    <span class="n">bg_mean</span><span class="p">,</span> <span class="n">bg_cov</span><span class="p">,</span> <span class="n">bg_age</span><span class="p">,</span> <span class="n">bg_nstars</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">assoc_stars</span> <span class="o">=</span> <span class="n">synthdata</span><span class="o">.</span><span class="n">generate_association</span><span class="p">(</span>
    <span class="n">assoc_mean</span><span class="p">,</span> <span class="n">assoc_cov</span><span class="p">,</span> <span class="n">assoc_age</span><span class="p">,</span> <span class="n">assoc_nstars</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">stars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">assoc_stars</span><span class="p">,</span> <span class="n">bg_stars</span><span class="p">))</span>

<span class="c1"># To make things easy, we scale down typical Gaia uncertainties by 70%</span>
<span class="n">synthdata</span><span class="o">.</span><span class="n">SynthData</span><span class="o">.</span><span class="n">m_err</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="c1"># Measure astrometry and get a fits table, this will be the input into `prepare-data`</span>
<span class="n">astrometry</span> <span class="o">=</span> <span class="n">synthdata</span><span class="o">.</span><span class="n">SynthData</span><span class="o">.</span><span class="n">measure_astrometry</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>

<span class="c1"># Lets just quickly check for bad data, in particular, bad parallaxes</span>
<span class="c1"># we know the stars have a position spread of 1000 pc, so shouldn&#39;t be</span>
<span class="c1"># many stars beyond 1,000 pc, therefore we ignore any stars with parallax</span>
<span class="c1"># less than 1 mas</span>
<span class="n">subset_astrometry</span> <span class="o">=</span> <span class="n">astrometry</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">astrometry</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">)]</span>
<span class="n">subset_astrometry</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;synth_astro.fits&#39;</span><span class="p">)</span>

<span class="c1"># Just for fun, lets save the &quot;true memberships&quot;, but mask out stars with bad</span>
<span class="c1"># parallax</span>
<span class="n">true_membs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">assoc_nstars</span> <span class="o">+</span> <span class="n">bg_nstars</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">true_membs</span><span class="p">[:</span><span class="n">assoc_nstars</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">true_membs</span><span class="p">[</span><span class="n">assoc_nstars</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">subset_true_membs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">true_membs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">astrometry</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">)])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;true_membs.npy&#39;</span><span class="p">,</span> <span class="n">subset_true_membs</span><span class="p">)</span>

<span class="c1"># And if you want the data in arrays for whatever reason...</span>
<span class="n">astro_data</span> <span class="o">=</span> <span class="n">datatools</span><span class="o">.</span><span class="n">extract_array_from_table</span><span class="p">(</span><span class="n">astrometry</span><span class="p">)</span>
<span class="n">astro_means</span><span class="p">,</span> <span class="n">astro_covs</span> <span class="o">=</span> <span class="n">datatools</span><span class="o">.</span><span class="n">construct_covs_from_data</span><span class="p">(</span><span class="n">astro_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have a synthetic data set. You may inspect it by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;synth_astro.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">info</span>

<span class="go">&lt;Table length=1200&gt;</span>
<span class="go">         name          dtype</span>
<span class="go">--------------------- -------</span>
<span class="go">            source_id   int64</span>
<span class="go">                   ra float64</span>
<span class="go">             ra_error float64</span>
<span class="go">                  dec float64</span>
<span class="go">            dec_error float64</span>
<span class="go">             parallax float64</span>
<span class="go">       parallax_error float64</span>
<span class="go">                 pmra float64</span>
<span class="go">           pmra_error float64</span>
<span class="go">                pmdec float64</span>
<span class="go">          pmdec_error float64</span>
<span class="go">      radial_velocity float64</span>
<span class="go">radial_velocity_error float64</span>
</pre></div>
</div>
</section>
<section id="using-prepare-data">
<h3>Using Prepare Data<a class="headerlink" href="#using-prepare-data" title="Permalink to this heading">#</a></h3>
<p>We can convert this back into cartesian space, complete with covariance matrices,by the following command-line tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ prepare-data synth_astro.fits
</pre></div>
</div>
<p>This will generate 4 files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_means.npy</span></code>: the cartesian means of the data, with shape <code class="docutils literal notranslate"><span class="pre">(n_stars,</span> <span class="pre">6)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_covs.npy</span></code>: the cartesian covariances of the data, with shape <code class="docutils literal notranslate"><span class="pre">(n_stars,</span> <span class="pre">6,</span> <span class="pre">6)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ids.npy</span></code>: a 1D array of the stars’ gaia <code class="docutils literal notranslate"><span class="pre">source_id</span></code>. This is useful for bookkeeping in the event some stars were discarded due to bad/missing data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all_data.npy</span></code>: a convenience file, equivalent to <code class="docutils literal notranslate"><span class="pre">np.vstack((data_means.T,</span> <span class="pre">data_covs.flatten().T)).T</span></code>, which is how <a class="reference internal" href="../api/chronostar.component.html#chronostar.component.spherespacetimecomponent.SphereSpaceTimeComponent" title="chronostar.component.spherespacetimecomponent.SphereSpaceTimeComponent"><code class="xref py py-class docutils literal notranslate"><span class="pre">SphereSpaceTimeComponent</span></code></a> will expect the data</p></li>
</ul>
<p>You can check what this cartesian data looks like by plotting it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ plot-features -m data_means.npy -c data_covs.npy -z true_membs.npy -f <span class="m">0</span>,1.0,2.1,2.0,3.1,4.2,5 -o synth_plots
</pre></div>
</div>
<p>Note that this may take a few seconds, since we’re plotting so many points. This will
generate a file <code class="docutils literal notranslate"><span class="pre">synth_plots/features.pdf</span></code>.</p>
<p>The result should look a little like this:</p>
<a class="reference internal image-reference" href="../_images/synth-features.svg"><img alt="A phase-space plot of synthetic data." src="../_images/synth-features.svg" width="800" /></a>
</section>
<section id="fitting-a-component">
<h3>Fitting a component<a class="headerlink" href="#fitting-a-component" title="Permalink to this heading">#</a></h3>
<p>For fun, lets fit a single component to the data. Since the data should
be dominated by the background, we should get a component that describes
the background, with similar mean and covariance to what we used to
generate the data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fit-component all_data.npy
</pre></div>
</div>
<p>You’ll get some raw output to the screen detailing the progress of a call
to <a class="reference internal" href="../api/chronostar.component.html#chronostar.component.spherespacetimecomponent.SphereSpaceTimeComponent.maximize" title="chronostar.component.spherespacetimecomponent.SphereSpaceTimeComponent.maximize"><code class="xref py py-func docutils literal notranslate"><span class="pre">maximize()</span></code></a>.
Each ‘H’ character represents 10 calls to the loss function, therefore each row
represents 500 such calls.</p>
<p>Since there are local minima every 20 Myr, we start the maximizations at
various different ages.</p>
<p>The results should look a little like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>age: <span class="m">0</span>.010
-------------------
----- RESULTS -----
-------------------
  - params
<span class="o">[</span> -0.98046999  <span class="m">13</span>.9609434   <span class="m">13</span>.77419365   <span class="m">0</span>.05277412   <span class="m">0</span>.76612056
  -0.80328497 <span class="m">344</span>.95381506  <span class="m">26</span>.0845931    <span class="m">0</span>.01014714<span class="o">]</span>
</pre></div>
</div>
<p>This says that the age is <code class="docutils literal notranslate"><span class="pre">0.01</span></code>, the mean is near-ish <code class="docutils literal notranslate"><span class="pre">0</span></code> for all but <code class="docutils literal notranslate"><span class="pre">Y</span></code> and <code class="docutils literal notranslate"><span class="pre">Z</span></code>, and
that the birth position standard deviation (<code class="docutils literal notranslate"><span class="pre">dxyz</span></code>) is ~<code class="docutils literal notranslate"><span class="pre">345</span></code> and the
birth velocity standard deviation (<code class="docutils literal notranslate"><span class="pre">duvw</span></code>) is ~<code class="docutils literal notranslate"><span class="pre">26</span></code>. Both of which are
relatively near the initial conditions of <code class="docutils literal notranslate"><span class="pre">500</span></code> and <code class="docutils literal notranslate"><span class="pre">30</span></code> respectively.</p>
<p>The cause of the smaller standard deviations is likely attributable to the
overdenisty caused by the association stars. We didn’t expect anything useful
from this fit though, it was just for fun.</p>
</section>
<section id="fitting-a-mixture">
<h3>Fitting a Mixture<a class="headerlink" href="#fitting-a-mixture" title="Permalink to this heading">#</a></h3>
<p>Lets fit a mixture model. For starters, lets help things start off by providing
the true memberships as the initial memberships. For this we need to configure
some settings. Write a <cite>config-mixture.yaml</cite> file with the following contents:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mixture</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">init_params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_resp</span><span class="w"></span>

<span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">savedir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output-mixture</span><span class="w"></span>
</pre></div>
</div>
<p>Now call:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fit-mixture c config-mixture.yaml <span class="m">2</span> all_data.npy true_membs.npy
</pre></div>
</div>
<p>This will kick off a 2-component mixture fit. The first component to be fit
will be the association. Watch the output carefully. See that the maximize
with <cite>age_offset=0.0</cite> gets an age of 0.0 (<cite>res.x[-1]=0.00</cite>), but the later
offsets get larger ages, and indeed the best age is determined to be ~<cite>30</cite>.</p>
<p>The final results should look a little something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-------------------</span>
<span class="o">-----</span> <span class="n">RESULTS</span> <span class="o">-----</span>
<span class="o">-------------------</span>
<span class="o">---</span> <span class="n">component</span> <span class="mi">0</span> <span class="o">---</span>
 <span class="n">weight</span><span class="p">:</span> <span class="mf">0.21557755108623822</span>
 <span class="n">params</span><span class="p">:</span>
<span class="p">[</span><span class="o">-</span><span class="mf">47.28802468</span>   <span class="mf">3.81141519</span>  <span class="o">-</span><span class="mf">6.19299571</span>   <span class="mf">1.74412884</span>  <span class="o">-</span><span class="mf">0.1221947</span>
  <span class="o">-</span><span class="mf">0.66227324</span>  <span class="mf">51.55373574</span>   <span class="mf">1.54039683</span>  <span class="mf">30.28259584</span><span class="p">]</span>
<span class="o">---</span> <span class="n">component</span> <span class="mi">1</span> <span class="o">---</span>
 <span class="n">weight</span><span class="p">:</span> <span class="mf">0.7844224489137618</span>
 <span class="n">params</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">0.29853494</span>  <span class="mf">17.91797311</span>  <span class="mf">18.17695939</span>  <span class="o">-</span><span class="mf">0.18002624</span>   <span class="mf">0.72729977</span>
  <span class="o">-</span><span class="mf">1.1947355</span>  <span class="mf">388.74496962</span>  <span class="mf">29.45825668</span>   <span class="mf">0.00000144</span><span class="p">]</span>
</pre></div>
</div>
<p>You can compare the standard deviations (the 3rd and 2nd last array elements)
and see they all match well except for the background component’s <code class="docutils literal notranslate"><span class="pre">dxyz</span></code>,
most likely because we discarded stars with low parallax (large distance) and
shrunk our dataset down.</p>
<p>We can go ahead and plot this now:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ plot-features -m data_means.npy -c data_covs.npy -z output-mixture/memberships.npy -r output-mixture/ -f <span class="m">0</span>,1.0,2.1,2.0,3.1,4.2,5 -o plots-mixture -b
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-r</span></code> option points to the results of the fit, specifically the stored parameters of the components. The <code class="docutils literal notranslate"><span class="pre">-b</span></code> flag makes all components with ages less than <code class="docutils literal notranslate"><span class="pre">0</span></code> coloured grey.</p>
<p>The result should look a little like this:</p>
<a class="reference internal image-reference" href="../_images/synth-mixture-features.svg"><img alt="A phase-space plot of synthetic data." src="../_images/synth-mixture-features.svg" width="800" /></a>
<p>We could hypothetically also try a mixture fit with no initial help. Modify the <cite>config-mixture.yml</cite> file
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mixture</span><span class="p">:</span>
    <span class="n">init_params</span><span class="p">:</span> <span class="n">random</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="mi">2</span>
    <span class="n">verbose_interval</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">tol</span><span class="p">:</span> <span class="mf">1.e-5</span>

<span class="n">run</span><span class="p">:</span>
    <span class="n">savedir</span><span class="p">:</span> <span class="n">output</span><span class="o">-</span><span class="n">mixture</span><span class="o">-</span><span class="n">nohelp</span>
</pre></div>
</div>
<p>This will use scikit-learn’s kmeans implementation to initialise memberships
to the components. See <a class="reference internal" href="../userdocs/settings.html#settings"><span class="std std-ref">Configuration Settings</span></a> for a complete list of all configuration settings.
We must reduce the tolerance from sklearn’s default of <code class="docutils literal notranslate"><span class="pre">1.e-3</span></code> down to <code class="docutils literal notranslate"><span class="pre">1.e-5</span></code> because the change in
average log probability is very subtle in the early EM iterations. In general,
this value should be <code class="docutils literal notranslate"><span class="pre">1.e-4</span></code> or lower.</p>
<p>However, this is not Chronostar’s intended purpose, so there’s no guarantee this will yield useful results…</p>
</section>
<section id="fitting-chronostar">
<h3>Fitting Chronostar<a class="headerlink" href="#fitting-chronostar" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">config-chron.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">component</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Default is total number of cores, and controlled by environment variable</span><span class="w"></span>
<span class="w">    </span><span class="c1"># NUMBA_NUM_THREADS</span><span class="w"></span>
<span class="w">    </span><span class="nt">nthreads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>

<span class="nt">mixture</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">tol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.e-5</span><span class="w"></span>
<span class="w">    </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">    </span><span class="nt">verbose_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>

<span class="nt">driver</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">intermediate_dumps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
<span class="w">    </span><span class="nt">savedir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output-chron/intermediate</span><span class="w"></span>

<span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">savedir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output-chron/final</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-chronostar -c config-chron.yml data_all.npy
</pre></div>
</div>
<p>This takes on the order of a couple of hours. You may want to run it in the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nohup fit-chronostar -c config-chron.yml data_all.npy &gt; logs-chron.out &amp;
</pre></div>
</div>
<p>Your standard out (or <code class="docutils literal notranslate"><span class="pre">logs-chron.out</span></code> file) should begin like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>Letting introducer generate first IC
<span class="linenos"> 2</span>self.n_generations=0
<span class="linenos"> 3</span>[DRIVER] Fitting AAA-XXX-0000-0001-auto
<span class="linenos"> 4</span>[DRIVER] init_comps[0].parameters_set=False
<span class="linenos"> 5</span>--------------------------------------------------
<span class="linenos"> 6</span>Fitting 1-comp mixture
<span class="linenos"> 7</span>--------------------------------------------------
<span class="linenos"> 8</span>Initialization 0
<span class="linenos"> 9</span>[SKLMixture._initialize_parameters]: Initializing parameters!
<span class="linenos">10</span>[SKLMixture._initialize_parameters]: self.init_params=&#39;random&#39;
<span class="linenos">11</span>[SphereSpaceTimeComponent.maximize] self.nthreads=None
</pre></div>
</div>
<p>At the moment the output are arbitrary print statements, so will likely change as logging becomes more sophisticated. Line 0 tells us that the <code class="docutils literal notranslate"><span class="pre">ICPool</span></code> was responsible for generating the first <a class="reference internal" href="../api/chronostar.html#chronostar.base.InitialCondition" title="chronostar.base.InitialCondition"><code class="xref py py-class docutils literal notranslate"><span class="pre">InitialCondition</span></code></a>.
Line 2 tells us which mixture the <a class="reference internal" href="../api/chronostar.html#chronostar.driver.Driver" title="chronostar.driver.Driver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Driver</span></code></a> is fitting.
The name of the mixture is very descriptive and is intended to remain applicable regardless of the specific classes used by the driver.</p>
<p>The first part is a 3 digit unique identifier, which counts upwards from <code class="docutils literal notranslate"><span class="pre">AAA</span></code> for each mixture. The second part is the 3 digit unique identify of this mixtures “parent”, i.e. the previous mixture which the <code class="docutils literal notranslate"><span class="pre">ICPool</span></code> used to generate this mixture’s generation. Since this is the first mixture, it has no parent, and is thus labeled <code class="docutils literal notranslate"><span class="pre">XXX</span></code>. The third part is the generation number of this mixture. The fourth part is the number of components in this mixture. The final part is an optional extra chosen by the <code class="docutils literal notranslate"><span class="pre">ICPool</span></code> in use. In this case, it will tell us which component of the parent mixture <code class="docutils literal notranslate"><span class="pre">ICPool</span></code> split in two in order to generate this mixture. Again, since this is the first mixture, this doesn’t have a useful value.</p>
<p>For reference, the next mixture label will be <code class="docutils literal notranslate"><span class="pre">AAB-AAA-0001-0002-0</span></code>. It is the <code class="docutils literal notranslate"><span class="pre">AAB</span></code>th mixture. Its parent was <code class="docutils literal notranslate"><span class="pre">AAA</span></code>, it is from generation <code class="docutils literal notranslate"><span class="pre">1</span></code>, has <code class="docutils literal notranslate"><span class="pre">2</span></code> components and was initialised by splitting component <code class="docutils literal notranslate"><span class="pre">0</span></code> (the only component) of mixture <code class="docutils literal notranslate"><span class="pre">AAA</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ICPool</span></code> uses this label for bookkeeping and for receiving score reports from the <code class="docutils literal notranslate"><span class="pre">Driver</span></code>. The label also serves as the directory names of intermediate dumps.</p>
<p>If all goes well, <code class="docutils literal notranslate"><span class="pre">fit-chronostar</span></code> should terminate after trialling two 3-component mixtures and rejecting them in favour of the sole 2-component mixture (<code class="docutils literal notranslate"><span class="pre">AAB</span></code>), meaning your <code class="docutils literal notranslate"><span class="pre">output-chron/intermediate</span></code> directory looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">AAA</span><span class="o">-</span><span class="n">XXX</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0001</span><span class="o">-</span><span class="n">auto</span>
<span class="linenos">2</span><span class="n">AAB</span><span class="o">-</span><span class="n">AAA</span><span class="o">-</span><span class="mi">0001</span><span class="o">-</span><span class="mi">0002</span><span class="o">-</span><span class="mi">0</span>
<span class="linenos">3</span><span class="n">AAC</span><span class="o">-</span><span class="n">AAB</span><span class="o">-</span><span class="mi">0002</span><span class="o">-</span><span class="mi">0003</span><span class="o">-</span><span class="mi">0</span>
<span class="linenos">4</span><span class="n">AAD</span><span class="o">-</span><span class="n">AAB</span><span class="o">-</span><span class="mi">0002</span><span class="o">-</span><span class="mi">0003</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>Assuming the run has terminated successfully, the best fitting mixture is implicitly <code class="docutils literal notranslate"><span class="pre">AAB</span></code>, because the 3-component fits (lines 2 and 3) were the last mixtures attempted (therefore failed to improve the BIC) and their parent was <code class="docutils literal notranslate"><span class="pre">AAB</span></code>.</p>
<p>In each of these subdirectories, you will find a text file with detailed description of the configuration parameters, BIC score, weights, member counts and component parameters. You will also find a collection of numpy arrays: one for each component with their best fitting parameters, one for the relative weights of the components, and one for the membership probabilities.</p>
<p>In your <code class="docutils literal notranslate"><span class="pre">output-chron/final</span></code> directory you’ll find the same information and the same files but for the best fit.</p>
</section>
</section>
<section id="beta-pictoris-moving-group">
<h2>Beta Pictoris Moving Group<a class="headerlink" href="#beta-pictoris-moving-group" title="Permalink to this heading">#</a></h2>
<p>Here we detail how one could go about fitting to the Beta Pictoris Moving Group.</p>
<p>The process is as follows:</p>
<ul class="simple">
<li><p>query Gaia DR3 for all stars’ kinematics within 100pc with decent parallaxes (errors better than 3%)</p></li>
<li><p>use <cite>prepare-data</cite> <a class="reference internal" href="../userdocs/cli.html#dataprep"><span class="std std-ref">(a CLI tool)</span></a> to convert astrometry to cartesian coordinates, ignoring stars with highly uncertain (or missing) radial velocities for now</p></li>
<li><p>apply some data cuts based on known cartesian fits</p></li>
<li><p>fit a gaussian to this data</p></li>
<li><p>find the top 2,000 candidates for this region (using overlap integrals)</p></li>
<li><p>unleash chronostar on the prepared data</p></li>
</ul>
<section id="querying-gaia-dr3">
<h3>Querying Gaia DR3<a class="headerlink" href="#querying-gaia-dr3" title="Permalink to this heading">#</a></h3>
<p>Navigate to Gaia DR3’s Advanced ADQL query and submit the following query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span>
<span class="o">--</span> <span class="n">Astrometry</span>
<span class="n">g</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra_error</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dec_error</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">parallax</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">parallax_error</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">pmra</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">pmra_error</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">pmdec</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">pmdec_error</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra_dec_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra_parallax_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra_pmra_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ra_pmdec_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dec_parallax_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dec_pmra_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dec_pmdec_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">parallax_pmra_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">parallax_pmdec_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">pmra_pmdec_corr</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ruwe</span><span class="p">,</span>
<span class="o">--</span> <span class="n">Gaia</span> <span class="n">photometry</span>
<span class="n">g</span><span class="o">.</span><span class="n">phot_g_mean_mag</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">phot_bp_mean_mag</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">phot_rp_mean_mag</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bp_rp</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">g_rp</span><span class="p">,</span>
<span class="o">--</span> <span class="n">Radial</span> <span class="n">velocities</span>
<span class="n">g</span><span class="o">.</span><span class="n">radial_velocity</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">radial_velocity_error</span>
<span class="n">FROM</span> <span class="n">gaiadr3</span><span class="o">.</span><span class="n">gaia_source</span> <span class="k">as</span> <span class="n">g</span>
<span class="o">--</span> <span class="n">BPMG</span><span class="p">:</span> <span class="n">stars</span> <span class="n">closer</span> <span class="n">than</span> <span class="mi">100</span><span class="n">pc</span> <span class="ow">and</span> <span class="mi">3</span><span class="o">%</span> <span class="ow">or</span> <span class="n">better</span> <span class="n">error</span>
<span class="n">WHERE</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">parallax</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="n">AND</span> <span class="n">g</span><span class="o">.</span><span class="n">parallax_error</span><span class="o">/</span><span class="n">g</span><span class="o">.</span><span class="n">parallax</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">)</span>
</pre></div>
</div>
<p>This should get you 285,885 rows.</p>
<p>Because BPMG surrounds the Earth it is tricky to apply any meaningful data cuts, and hence we get a very large dataset.</p>
<p>Download this data as a fits file.</p>
<p>Extract the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gunzip</span> <span class="n">xxxxxxxxxxxxxxx</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Rename the file to something memorable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="n">xxxxxxxxxxxxxxx</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fits</span> <span class="n">betapic</span><span class="o">-</span><span class="mi">100</span><span class="n">pc</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
</section>
<section id="converting-to-cartesian">
<h3>Converting to Cartesian<a class="headerlink" href="#converting-to-cartesian" title="Permalink to this heading">#</a></h3>
<p>Chronostar comes with a command line tool <code class="docutils literal notranslate"><span class="pre">prepare-data</span></code>. This tool reads in a fits file from Gaia and converts the data into cartesian coordinates.</p>
<p>Lets do that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepare</span><span class="o">-</span><span class="n">data</span> <span class="o">-</span><span class="n">fw</span> <span class="n">betapic</span><span class="o">-</span><span class="mi">100</span><span class="n">pc</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-f</span></code> flag tells <code class="docutils literal notranslate"><span class="pre">prepare-data</span></code> to replace any missing radial velocities with a fake value (determined by averaging the available radial velocities) with an uncertainty of 10,000 km/s. The <code class="docutils literal notranslate"><span class="pre">-w</span></code> flag tells <code class="docutils literal notranslate"><span class="pre">prepare-data</span></code> to overwrite the fits file with any modifications. Since we’re inserting some fake rvs, we would like the file to remember this.</p>
<p>The conversion should take around 5 minutes.</p>
<p>As a result you should get the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_means.npy</span></code>: the cartesian means of each converted star</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_covs.npy</span></code>: the cartesian covariances of each converted star</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_all.npy</span></code>: the full cartesian data (<code class="docutils literal notranslate"><span class="pre">np.vstack((data_means.T,</span> <span class="pre">data_covs.reshape(-1,36).T)).T</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ids.npy</span></code>: the source ids of all stars successfully converted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fake_rvs_id.npy</span></code>: the source ids of all stars provided with fake radial velocities</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fake_rvs_mask.npy</span></code>: a boolean mask of all the converted stars that were given fake rvs</p></li>
</ul>
<p>To keep things tidy, we store these files in a subdirectory. You may keep your directory structure flat if you like, but make sure to modify the paths appropriately in the following snippets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">data</span><span class="o">-</span><span class="n">full</span>
<span class="n">mv</span> <span class="o">*.</span><span class="n">npy</span> <span class="n">data</span><span class="o">-</span><span class="n">full</span>
</pre></div>
</div>
<p>When that’s done, we can apply the cartesian data cuts on all stars:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">datadir</span> <span class="o">=</span> <span class="s1">&#39;data-full/&#39;</span>
<span class="n">rvsdir</span> <span class="o">=</span> <span class="s1">&#39;rvs-subset-data/&#39;</span>

<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_means.npy&#39;</span><span class="p">)</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_covs.npy&#39;</span><span class="p">)</span>
<span class="nb">all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_all.npy&#39;</span><span class="p">)</span>
<span class="n">fake_rvs_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;fake_rvs_mask.npy&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;betapic-100pc.fits&#39;</span><span class="p">)</span>

<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">110.</span><span class="p">,</span>  <span class="mf">50.</span><span class="p">,</span>  <span class="mf">60.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">])</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">60.</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.</span><span class="p">])</span>

<span class="c1"># Extract stars that are both within bounds and have real rvs</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">means</span> <span class="o">&gt;</span> <span class="n">lower_bound</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">means</span> <span class="o">&lt;</span> <span class="n">upper_bound</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
       <span class="o">&amp;</span> <span class="o">~</span><span class="n">fake_rvs_mask</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>    <span class="c1"># should be ~725 stars</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs_subset_mask.npy&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs_subset_means.npy&#39;</span><span class="p">,</span> <span class="n">means</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs_subset_covs.npy&#39;</span><span class="p">,</span> <span class="n">covs</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs_subset_all.npy&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
<span class="n">subset_t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">subset_t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs-subset-betapic-100pc.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fitting-a-single-gaussian">
<h3>Fitting a single Gaussian<a class="headerlink" href="#fitting-a-single-gaussian" title="Permalink to this heading">#</a></h3>
<p>Now lets fit a single component to the subset data.
First write a simple <code class="docutils literal notranslate"><span class="pre">config-comp.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">modules</span><span class="p">:</span>
    <span class="n">component</span><span class="p">:</span> <span class="n">SpaceComponent</span>

<span class="n">run</span><span class="p">:</span>
    <span class="n">savedir</span><span class="p">:</span> <span class="n">result</span><span class="o">-</span><span class="n">comp</span>
</pre></div>
</div>
<p>Since we’re not bothering with age, we can fit a free 6D gaussian, which is implemented by <a class="reference internal" href="../api/chronostar.component.html#chronostar.component.spacecomponent.SpaceComponent" title="chronostar.component.spacecomponent.SpaceComponent"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpaceComponent</span></code></a>.
This class doesn’t consider uncertainties, so we just give it the means:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">-</span><span class="n">component</span> <span class="o">-</span><span class="n">c</span> <span class="n">config</span><span class="o">-</span><span class="n">comp</span><span class="o">.</span><span class="n">yml</span> <span class="n">rvs</span><span class="o">-</span><span class="n">subset</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">rvs_subset_means</span><span class="o">.</span><span class="n">npy</span>
</pre></div>
</div>
<p>We’ll get a result in <code class="docutils literal notranslate"><span class="pre">result-comp</span></code> directory as well as some output text.
The first 6 parameters of a <code class="docutils literal notranslate"><span class="pre">SpaceComponent</span></code> are its cartesian mean, the remaining 36 are its flattend covariance matrix, i.e. <code class="docutils literal notranslate"><span class="pre">params</span> <span class="pre">=</span> <span class="pre">np.hstack(mean,</span> <span class="pre">cov.flatten())</span></code>, and equivalently: <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">=</span> <span class="pre">params[:6];</span> <span class="pre">cov</span> <span class="pre">=</span> <span class="pre">params[6:].reshape(6,6)</span></code>.</p>
<section id="fitting-rv-only-chronostar">
<h4>Fitting RV Only Chronostar<a class="headerlink" href="#fitting-rv-only-chronostar" title="Permalink to this heading">#</a></h4>
<p>If stars without rvs aren’t important to you, you could run chronostar on this subset.</p>
<p>Make a <code class="docutils literal notranslate"><span class="pre">config-chron-rvs.yml</span></code> file</p>
<blockquote>
<div><dl class="simple">
<dt>modules:</dt><dd><p>component: SphereSpaceTimeComponent     # default
mixture: ComponentMixture               # default</p>
</dd>
<dt>mixture:</dt><dd><p>init_parmas: random                     # default
verbose: 2                              # defaut
verbose_interval: 1
tol: 1.e-5</p>
</dd>
<dt>component:</dt><dd><p>nthreads: 8     # or leave out in order to use all available cores by default</p>
</dd>
<dt>driver:</dt><dd><p>savedir: result-chron-rvs/intermediate</p>
</dd>
<dt>run:</dt><dd><p>savedir: result-chron-rvs/final</p>
</dd>
</dl>
</div></blockquote>
<p>And run chronostar on the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-chronostar -c config-chron-rvs.yml rvs-subset-data/rvs_subset_all.npy
</pre></div>
</div>
</section>
</section>
<section id="apply-data-cuts-to-rvless-stars">
<h3>Apply data cuts to rvless stars<a class="headerlink" href="#apply-data-cuts-to-rvless-stars" title="Permalink to this heading">#</a></h3>
<p>The simplest means I can think of for how to apply a data restriction to the tens of thousands of rv-less stars which fall within the positional data bounds, is to evaluate their overlap integrals with our dataset with rvs, and pick the top N stars. Lets say the top 500, such that the majority of our data still has RVs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">chronostar.component.spacecomponent</span> <span class="kn">import</span> <span class="n">SpaceComponent</span>
<span class="kn">from</span> <span class="nn">chronostar.maths</span> <span class="kn">import</span> <span class="n">estimate_log_gaussian_ol_prob</span>
<span class="c1"># If you face issues with the jit compiled version, there&#39;s a pure python:</span>
<span class="c1"># from chronostar.maths import estimate_log_gaussian_ol_prob_py</span>

<span class="n">datadir</span> <span class="o">=</span> <span class="s1">&#39;data-full/&#39;</span>
<span class="n">rvsdir</span> <span class="o">=</span> <span class="s1">&#39;rvs-subset-data/&#39;</span>
<span class="n">rvlessdir</span> <span class="o">=</span> <span class="s1">&#39;rvless-subset-data/&#39;</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;result-comp/params.npy&#39;</span><span class="p">)</span>
<span class="n">comp</span> <span class="o">=</span> <span class="n">SpaceComponent</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_means.npy&#39;</span><span class="p">)</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_covs.npy&#39;</span><span class="p">)</span>
<span class="nb">all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;data_all.npy&#39;</span><span class="p">)</span>

<span class="n">fake_rvs_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;fake_rvs_mask.npy&#39;</span><span class="p">)</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">datadir</span> <span class="o">+</span> <span class="s1">&#39;ids.npy&#39;</span><span class="p">)</span>

<span class="n">ln_overlaps</span> <span class="o">=</span> <span class="n">estimate_log_gaussian_ol_prob</span><span class="p">(</span>
    <span class="n">data_all</span><span class="p">,</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">covariance</span>
<span class="p">)</span>

<span class="n">n_stars</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">n_rvless_stars</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fake_rvs_mask</span><span class="p">)</span>

<span class="c1"># Calculate the cut off percentile for the top 500 ln_overlaps for rv-less stars</span>
<span class="n">percentile</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n_stars</span> <span class="o">/</span> <span class="n">n_rvless_stars</span><span class="p">)</span>       <span class="c1"># the required percentile</span>
<span class="n">cut_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">ln_overlaps</span><span class="p">[</span><span class="n">fake_rvs_mask</span><span class="p">],</span> <span class="n">percentile</span><span class="p">)</span>

<span class="c1"># Sanity check:</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wanted </span><span class="si">{</span><span class="n">n_stars</span><span class="si">}</span><span class="s2"> rvless stars,&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">ln_overlaps</span><span class="p">[</span><span class="n">fake_rvs_mask</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cut_off</span><span class="p">)</span><span class="si">}</span><span class="s2"> rvless stars.&quot;</span><span class="p">)</span>

<span class="n">top_rvless_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ln_overlaps</span> <span class="o">&gt;</span> <span class="n">cut_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">fake_rvs_mask</span>

<span class="n">bound_stars_with_rvs_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rvsdir</span> <span class="o">+</span> <span class="s1">&#39;rvs_subset_mask.npy&#39;</span><span class="p">)</span>

<span class="c1"># Build mask for stars with rvs within bounds as well as the top rvless stars</span>
<span class="n">top_stars</span> <span class="o">=</span> <span class="n">bound_stars_with_rvs_mask</span> <span class="o">|</span> <span class="n">top_rvless_mask</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvlessdir</span> <span class="o">+</span> <span class="s1">&#39;rvless_subset_means.npy&#39;</span><span class="p">,</span> <span class="n">means</span><span class="p">[</span><span class="n">top_stars</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvlessdir</span> <span class="o">+</span> <span class="s1">&#39;rvless_subset_covs.npy&#39;</span><span class="p">,</span> <span class="n">covs</span><span class="p">[</span><span class="n">top_stars</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvlessdir</span> <span class="o">+</span> <span class="s1">&#39;rvless_subset_all.npy&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="p">[</span><span class="n">top_stars</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rvlessdir</span> <span class="o">+</span> <span class="s1">&#39;rvless_subset_ids.npy&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="p">[</span><span class="n">top_stars</span><span class="p">])</span>

<span class="c1"># If you like you could also store a subset of the table</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;betapic-100pc.fits&#39;</span><span class="p">)</span>
<span class="n">rvless_subset_t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">],</span> <span class="n">ids</span><span class="p">[</span><span class="n">top_stars</span><span class="p">]))]</span>
<span class="n">rvless_subset_t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rvlessdir</span> <span class="o">+</span> <span class="s1">&#39;rvless_subset_t.fits&#39;</span><span class="p">)</span>

<span class="c1"># It&#39;s a lot of files....</span>
<span class="c1"># perhaps some cleaner approach is needed with subdirectories...</span>
</pre></div>
</div>
<p>Now, we have 1,500 stars, all within the vicinity of BPMG, with every rv-less star that is plausibly a member!</p>
</section>
<section id="running-chronostar">
<h3>Running Chronostar<a class="headerlink" href="#running-chronostar" title="Permalink to this heading">#</a></h3>
<p>Without further ado, lets run chronostar! Make a <code class="docutils literal notranslate"><span class="pre">config-chron.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">modules</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SphereSpaceTimeComponent</span><span class="w">     </span><span class="c1"># default</span><span class="w"></span>
<span class="w">    </span><span class="nt">mixture</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ComponentMixture</span><span class="w">               </span><span class="c1"># default</span><span class="w"></span>

<span class="nt">mixture</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">init_parmas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random</span><span class="w">                     </span><span class="c1"># default</span><span class="w"></span>
<span class="w">    </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">                              </span><span class="c1"># defaut</span><span class="w"></span>
<span class="w">    </span><span class="nt">verbose_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">tol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.e-5</span><span class="w"></span>

<span class="nt">component</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">nthreads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w">     </span><span class="c1"># or leave out in order to use all available cores by default</span><span class="w"></span>

<span class="nt">driver</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">savedir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result-chron/intermediate</span><span class="w"></span>

<span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">savedir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result-chron/final</span><span class="w"></span>
</pre></div>
</div>
<p>aaaaannnnndd lets go!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-chronostar -c config-chron.yml rvless-subset-data/rvless_subset_all.npy
</pre></div>
</div>
<p>The authors haven’t gotten this far yet, so who knows what will happen! Good luck!</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../api/modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">src</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../guides/driverguide.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Driver Guide</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Timothy Crundall
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Worked Examples</a><ul>
<li><a class="reference internal" href="#synthetic-example">Synthetic Example</a><ul>
<li><a class="reference internal" href="#generating-synthetic-data">Generating Synthetic Data</a></li>
<li><a class="reference internal" href="#using-prepare-data">Using Prepare Data</a></li>
<li><a class="reference internal" href="#fitting-a-component">Fitting a component</a></li>
<li><a class="reference internal" href="#fitting-a-mixture">Fitting a Mixture</a></li>
<li><a class="reference internal" href="#fitting-chronostar">Fitting Chronostar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#beta-pictoris-moving-group">Beta Pictoris Moving Group</a><ul>
<li><a class="reference internal" href="#querying-gaia-dr3">Querying Gaia DR3</a></li>
<li><a class="reference internal" href="#converting-to-cartesian">Converting to Cartesian</a></li>
<li><a class="reference internal" href="#fitting-a-single-gaussian">Fitting a single Gaussian</a><ul>
<li><a class="reference internal" href="#fitting-rv-only-chronostar">Fitting RV Only Chronostar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apply-data-cuts-to-rvless-stars">Apply data cuts to rvless stars</a></li>
<li><a class="reference internal" href="#running-chronostar">Running Chronostar</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>