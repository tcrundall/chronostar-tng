<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Scripts" href="scripts.html" /><link rel="prev" title="Quickstart" href="quickstart.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Command-Line Interface - chronostar-tng 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">chronostar-tng 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">chronostar-tng 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to Chronostar</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../gettingstarted.html">Getting Started</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Command-Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html">Scripts</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../generaloverview.html">General Overview</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/componentguide.html">Component Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/mixtureguide.html">Mixture Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/icpoolguide.html">Initial Conditions Pool Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/driverguide.html">Driver Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/workedexamples.html">Worked Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Configuration Settings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/modules.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/chronostar.html">chronostar package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.component.html">chronostar.component package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.icpool.html">chronostar.icpool package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.mixture.html">chronostar.mixture package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/chronostar.utils.html">chronostar.utils package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="command-line-interface">
<span id="cli"></span><h1>Command-Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this heading">#</a></h1>
<p>Chronostar provides three command line tools for analyzing data: <code class="code docutils literal notranslate"><span class="pre">fit-component</span></code>, <code class="code docutils literal notranslate"><span class="pre">fit-mixture</span></code>
and <code class="code docutils literal notranslate"><span class="pre">fit-chronostar</span></code>. Each of these tools serve as entry points to different
levels of complexity.</p>
<p>There are also two helper tools <code class="code docutils literal notranslate"><span class="pre">prepare-data</span></code> and <code class="code docutils literal notranslate"><span class="pre">plot-features</span></code>.
<code class="code docutils literal notranslate"><span class="pre">prepare-data</span></code> assists users in converting fits tables from Gaia into the
appropriate format expected by Chronostar. See <a class="reference internal" href="../examples/workedexamples.html#bpmg-example"><span class="std std-ref">the worked example on BPMG</span></a>
for a demonstration.
<code class="code docutils literal notranslate"><span class="pre">plot-features</span></code> is a convenience
tool that plots various 2D projections of the data’s feature space, as well as
colour magnitude diagrams.</p>
<p>To get all available arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepare</span><span class="o">-</span><span class="n">data</span> <span class="o">-</span><span class="n">h</span>
<span class="n">prepare</span><span class="o">-</span><span class="n">data</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>If you’d prefer to stay in python, sample scripts are explained in
<a class="reference internal" href="scripts.html"><span class="doc">Scripts</span></a>, or you may use the provided scripts
on <a class="reference external" href="https://github.com/tcrundall/chronostar-tng/tree/main/bin">github</a> as
inspiriation for your own scripts.</p>
<p>Each command  assumes you have a data as numpy array of shape
<code class="code docutils literal notranslate"><span class="pre">(n_samples,</span> <span class="pre">n_features)</span></code> stored as a <code class="code docutils literal notranslate"><span class="pre">.npy</span></code> file.</p>
<section id="data-input">
<h2>Data Input<a class="headerlink" href="#data-input" title="Permalink to this heading">#</a></h2>
<p>Chronostar’s <code class="xref py py-class docutils literal notranslate"><span class="pre">Driver</span></code> accepts data only as a single 2D array of shape
<code class="docutils literal notranslate"><span class="pre">(n_samples,</span> <span class="pre">n_features)</span></code>. For example, for the current default implementation,
in the absence of uncertainties, the input is a <code class="docutils literal notranslate"><span class="pre">(n_stars,</span> <span class="pre">6)</span></code> array where the
6 columns are <code class="docutils literal notranslate"><span class="pre">XYZUVW</span></code>.</p>
<p>If you wish to provide uncertainties in the form of a covariance matrix, the
matrices must be flattened and appended to the data array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">means</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">covariances</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>However, if you’re using the command line tool <a class="reference internal" href="#cli-chron"><span class="std std-ref">fit-chronostar</span></a>
this is handled for you, you need only provide the path to a stored
<code class="code docutils literal notranslate"><span class="pre">(n_stars,</span> <span class="pre">6,</span> <span class="pre">6)</span></code> numpy array of covariance matrices.</p>
<section id="converting-to-cartesian-coordinates">
<span id="dataprep"></span><h3>Converting to Cartesian Coordinates<a class="headerlink" href="#converting-to-cartesian-coordinates" title="Permalink to this heading">#</a></h3>
<p>The default implementation of Chronostar-TNG fits to data in a right handed
6D cartesian coordinate system, centred on the local standard of rest.</p>
<p>Since stellar data is typically provided as observables, we provide a command
line tool for converting fits files of observables into numpy arrays of cartesian
values.</p>
<p>Currently table column names are expected to be in the default form provided by
Gaia. First ensure your column names match that of Gaia:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;ra_error&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dec_error&#39;</span><span class="p">,</span> <span class="s1">&#39;parallax&#39;</span><span class="p">,</span> <span class="s1">&#39;parallax_error&#39;</span><span class="p">,</span>
<span class="s1">&#39;pmra&#39;</span><span class="p">,</span> <span class="s1">&#39;pmra_error&#39;</span><span class="p">,</span> <span class="s1">&#39;pmdec&#39;</span><span class="p">,</span> <span class="s1">&#39;pmdec_error&#39;</span><span class="p">,</span> <span class="s1">&#39;ra_dec_corr&#39;</span><span class="p">,</span> <span class="s1">&#39;ra_parallax_corr&#39;</span><span class="p">,</span> <span class="o">...</span>
 <span class="s1">&#39;radial_velocity&#39;</span><span class="p">,</span> <span class="s1">&#39;radial_velocity_error&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepare</span><span class="o">-</span><span class="n">data</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>This will try to convert each star (skipping those that have non-finite radial velocities)
from astrometry to cartesian. Upon completion you will have 3 files in the working directory.
The cartesian means will be <code class="code docutils literal notranslate"><span class="pre">data_means.npy</span></code>, the uncertainty covariance matrices will be
<code class="code docutils literal notranslate"><span class="pre">data_covs.npy</span></code>, and the <code class="code docutils literal notranslate"><span class="pre">source_id</span></code> will be in <code class="code docutils literal notranslate"><span class="pre">ids.npy</span></code>.</p>
<p>By default, you’ll also get a <code class="code docutils literal notranslate"><span class="pre">data_all.npy</span></code> file, which has the covariances
flattened and appended to the data. If you don’t want this file, you can skip it by calling</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepare</span><span class="o">-</span><span class="n">data</span> <span class="o">--</span><span class="n">nomerge</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ids</span></code> array is useful for identifying which rows of the table constitute your
data sample: <code class="code docutils literal notranslate"><span class="pre">subset_table</span> <span class="pre">=</span> <span class="pre">t[np.where(np.isin(t['source_id'],</span> <span class="pre">ids))]</span></code></p>
</div>
</section>
</section>
<section id="fitting-a-component">
<span id="cli-comp"></span><h2>Fitting a component<a class="headerlink" href="#fitting-a-component" title="Permalink to this heading">#</a></h2>
<p>This is for fitting a single component (e.g. a 6-D Gaussian) to the data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-component path/to/data.npy
</pre></div>
</div>
<p>One can optionally include membership probabilities. The membership
probabilities are expected as a numpy array of shape <code class="code docutils literal notranslate"><span class="pre">(n_samples)</span></code>
and stored in a <code class="code docutils literal notranslate"><span class="pre">.npy</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-component path/to/data.npy path/to/memberships.npy
</pre></div>
</div>
<p>The behaviour can be configured by providing a config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-component -c path/to/config.yml path/to/data.npy
</pre></div>
</div>
<p>An empty config file is valid. An example <code class="code docutils literal notranslate"><span class="pre">config.yml</span></code> file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># define which classes to import</span>
<span class="n">modules</span><span class="p">:</span>
   <span class="c1"># A 6D Gaussian with age and spherical birth covariance</span>
   <span class="n">component</span><span class="p">:</span> <span class="s2">&quot;SphereSpaceTimeComponent&quot;</span>

<span class="c1"># any configuration parameters specific to the component class</span>
<span class="n">component</span><span class="p">:</span>
   <span class="n">minimize_method</span><span class="p">:</span> <span class="s2">&quot;Nelder-Mead&quot;</span>  <span class="c1"># The scipy.optimize method</span>
   <span class="n">reg_covar</span><span class="p">:</span> <span class="mf">1.e-6</span>                <span class="c1"># Covariance matrix regularization constant</span>
   <span class="n">nthreads</span><span class="p">:</span> <span class="mi">4</span>                     <span class="c1"># How many numba threads to use for overlap integral calc</span>
   <span class="n">stellar_uncertainties</span><span class="p">:</span> <span class="kc">True</span>     <span class="c1"># If the final 36 columns of data file are covariances</span>

<span class="c1"># Specifics for the actual run</span>
<span class="n">run</span><span class="p">:</span>
   <span class="n">savedir</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span>         <span class="c1"># save directory for the results</span>
</pre></div>
</div>
<p>All component settings are listed <cite>here &lt;config-component&gt;</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to include the decimal point when using scientific
notation, or <code class="code docutils literal notranslate"><span class="pre">yaml</span></code> will treat the value as a string.</p>
</div>
</section>
<section id="fitting-a-mixture">
<span id="cli-mix"></span><h2>Fitting a mixture<a class="headerlink" href="#fitting-a-mixture" title="Permalink to this heading">#</a></h2>
<p>This is for fitting a fixed number of components to some data.</p>
<p>For example, to fit 5 components one would do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-mixture 5 path/to/data.npy
</pre></div>
</div>
<p>Similarly, one can provide a config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-mixture -c /path/to/config.yml 5 path/to/data.npy
</pre></div>
</div>
<p>One can also provide a membership probability file. Make sure the dimensions
match (n_stars, n_components)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fit-mixture -c path/to/config.yml <span class="m">5</span> path/to/data.npy path/to/membprobs.npy
</pre></div>
</div>
<p>Since a mixture model utilises components, one can provide component
configuration parameters along with those for the mixture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">modules</span><span class="p">:</span>
   <span class="n">component</span><span class="p">:</span> <span class="s2">&quot;SpaceComponent&quot;</span>      <span class="c1"># 6D Gaussian with no age</span>
   <span class="n">mixture</span><span class="p">:</span> <span class="s2">&quot;ComponentMixture&quot;</span>      <span class="c1"># Default mixture (currently no alterantives anyway)</span>

<span class="n">mixture</span><span class="p">:</span>
   <span class="n">max_iter</span><span class="p">:</span> <span class="mi">100</span>     <span class="c1"># Max number of EM iterations</span>
   <span class="n">tol</span><span class="p">:</span> <span class="mf">1e-4</span>         <span class="c1"># Tolerance for convergence</span>

   <span class="c1"># How a fresh mixture is initialized:</span>
   <span class="c1">#  - &#39;init_resp&#39;: use input membership probabilities</span>
   <span class="c1">#  - &#39;random&#39;: memberships are initialized randomly</span>
   <span class="c1">#  - &#39;kmeans&#39;: memberships are initialized using kmeans</span>
   <span class="c1">#  - &#39;k-means++&#39;: use the k-means++ method to initialize</span>
   <span class="n">init_params</span><span class="p">:</span> <span class="s1">&#39;random&#39;</span>
   <span class="c1"># Get SKLearn to print messages. 0 - nothing, 1 - a little, 2 - a lot</span>
   <span class="n">verbose</span><span class="p">:</span> <span class="mi">1</span>
   <span class="c1"># how many iterations to wait between SKLearn print messages</span>
   <span class="n">verbose_interval</span><span class="p">:</span> <span class="mi">10</span>

<span class="n">component</span><span class="p">:</span>
   <span class="n">reg_covar</span><span class="p">:</span> <span class="mf">1.e-5</span>
   <span class="n">minimize_method</span><span class="p">:</span> <span class="s1">&#39;Nelder-Mead&#39;</span>
   <span class="n">trace_orbit_func</span><span class="p">:</span> <span class="s1">&#39;epicyclic&#39;</span>
   <span class="n">age_offset_interval</span><span class="p">:</span> <span class="mi">20</span>         <span class="c1"># After how many M-steps offsets for a component&#39;s age are tried</span>

<span class="n">run</span><span class="p">:</span>
   <span class="n">savedir</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span>
</pre></div>
</div>
<p>All mixture settings are listed <cite>here &lt;config-mixture&gt;</cite></p>
</section>
<section id="finding-the-best-mixture">
<span id="cli-chron"></span><h2>Finding the best mixture<a class="headerlink" href="#finding-the-best-mixture" title="Permalink to this heading">#</a></h2>
<p>This is full Chronostar.
Chronostar begins with fitting a single component to the
data, then progressively introduces more components, fitting
more complex mixtures, until extra components cease improving
the fit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fit-chronostar -c path/to/config.yml path/to/data.npy
   or
$ fit-chronostar -c path/to/config.yml path/to/means.npy --covs path/to/covs.npy
</pre></div>
</div>
<p>An example config file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">modules</span><span class="p">:</span>
   <span class="n">component</span><span class="p">:</span> <span class="s2">&quot;SpaceComponent&quot;</span>      <span class="c1"># 6D Gaussian with no age</span>
   <span class="n">mixture</span><span class="p">:</span> <span class="s2">&quot;ComponentMixture&quot;</span>      <span class="c1"># Default mixture (currently no alterantives anyway)</span>
   <span class="n">icpool</span><span class="p">:</span> <span class="s2">&quot;SimpleICPool&quot;</span>           <span class="c1"># Manages a pool of initial conditions, determines how comps are introduced</span>

<span class="n">mixture</span><span class="p">:</span>
   <span class="n">max_iter</span><span class="p">:</span> <span class="mi">100</span>     <span class="c1"># Max number of EM iterations</span>
   <span class="n">tol</span><span class="p">:</span> <span class="mf">1e-4</span>         <span class="c1"># Tolerance for convergence</span>

<span class="n">component</span><span class="p">:</span>
   <span class="n">reg_covar</span><span class="p">:</span> <span class="mf">1.e-5</span>
   <span class="c1"># Unnecessary parameters will be ignored, e.g. the following two</span>
   <span class="c1"># parameters are for SphereSpaceTimeComponent, SpaceComponent will</span>
   <span class="c1"># print a warning, then continue</span>
   <span class="n">minimize_method</span><span class="p">:</span> <span class="s1">&#39;Nelder-Mead&#39;</span>
   <span class="n">trace_orbit_func</span><span class="p">:</span> <span class="s1">&#39;epicyclic&#39;</span>

<span class="n">icpool</span><span class="p">:</span> <span class="p">{}</span>        <span class="c1"># A title may be missing, but cannot point to nothing. An empty dictionary is allowed.</span>

<span class="n">run</span><span class="p">:</span>
   <span class="n">savedir</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span>
</pre></div>
</div>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Permalink to this heading">#</a></h2>
<p>A CLI tool for plotting is provided. It has two key functions so far. One is to plot features against features. Another is to plot CMDs. In both instances points are coloured by membership.</p>
<section id="features">
<span id="feat"></span><h3>Features<a class="headerlink" href="#features" title="Permalink to this heading">#</a></h3>
<p>Here is an example of plotting 6 phase-space planes (‘XY, XZ, YZ, XU, YV, ZW’) and saving the plot in a directory <code class="docutils literal notranslate"><span class="pre">plots</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="o">-</span><span class="n">features</span> <span class="o">-</span><span class="n">f</span> <span class="s1">&#39;0,1.0,2.1,2.0,3.1,4.2,5&#39;</span> <span class="o">-</span><span class="n">m</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">npy</span> <span class="o">-</span><span class="n">z</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">membership_probs</span><span class="o">.</span><span class="n">npy</span> <span class="o">-</span><span class="n">o</span> <span class="n">plots</span>
</pre></div>
</div>
<p>Each phase-space subplot is separated in the command by a period, i.e.
<code class="code docutils literal notranslate"><span class="pre">plot1-xaxis,plot1-yaxis.plot2-xaxis,plot2-yaxis</span></code> etc. You may add as many
phase-space pairs as you like, and they will be arranged top to bottom, left to right,
with as close to a square layout as possible.</p>
</section>
<section id="cmd">
<span id="id1"></span><h3>CMD<a class="headerlink" href="#cmd" title="Permalink to this heading">#</a></h3>
<p>Here is an example of plotting a CMD. Since the fits file likely featured rows with incomplete data, there will likely not be a one to one mapping from the membership probability table to the astrometry table. Hence <code class="docutils literal notranslate"><span class="pre">source_ids.npy</span></code> is used. <code class="docutils literal notranslate"><span class="pre">source_ids.npy</span></code> should be of shape <code class="docutils literal notranslate"><span class="pre">(n_stars)</span></code>
and has the gaia source id of each star in <code class="docutils literal notranslate"><span class="pre">membership_probs.npy</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="o">-</span><span class="n">features</span> <span class="o">--</span><span class="n">photom</span> <span class="o">-</span><span class="n">d</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">gaia</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">fits</span> <span class="o">-</span><span class="n">z</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">membership_probs</span><span class="o">.</span><span class="n">npy</span> <span class="o">-</span><span class="n">s</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source_ids</span><span class="o">.</span><span class="n">npy</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="scripts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Scripts</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="quickstart.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Quickstart</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Timothy Crundall
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Command-Line Interface</a><ul>
<li><a class="reference internal" href="#data-input">Data Input</a><ul>
<li><a class="reference internal" href="#converting-to-cartesian-coordinates">Converting to Cartesian Coordinates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fitting-a-component">Fitting a component</a></li>
<li><a class="reference internal" href="#fitting-a-mixture">Fitting a mixture</a></li>
<li><a class="reference internal" href="#finding-the-best-mixture">Finding the best mixture</a></li>
<li><a class="reference internal" href="#plotting">Plotting</a><ul>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#cmd">CMD</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>